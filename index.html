<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="js/Chart.min.js"></script>
    <script src="js/jquery-3.5.0.js"></script>
    <style>
      #myChart{
        position: relative;
        z-index: 0;
      }
      #position{
        position: absolute;
        left: 365px;
        font-size: 18px;
        margin-top: -285px;
        z-index: 2;
        font-weight: bold;
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
      }
      #ispu{
        position: absolute;
        margin-left: 350px;
        margin-top: -315px;
        font-weight: bold;
        text-align: center;
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
      }
    </style>
    <meta http-equiv="refresh" content="60000">
  </head>
  <body onload="startTime()" style="margin:0px;padding: 0px;">
    <table border="0" width="768" cellpadding="0" cellspacing="0">
      <tr>
        <td>
          <table style="font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;">
            <tr>
              <td><img src="image/icon_pelindo.png" alt="PT. Pelabuhan Indonesia 2 (Persero) Cabang Cirebon" width="200px"></td>
              <td><h1 style="font-size: 30px;">PT. Pelabuhan Indonesia 2 (Persero)<br>Cabang Cirebon</h1></td>
            </tr>
          </table>
          <table style="width:100%;font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;">
            <tr>
              <td style="background-color: blue;">
                <h1 style="color: white; text-align: center; font-size: 20px">Indeks Standar Pencemaran Udara (ISPU) <br> Update terakhir <a class="waktu"></a></h1>
              </td>
            </tr>
          </table>
          <br>
          <table width="100%">
            <tr>
              <td>
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3962.4484099712517!2d108.56710831512792!3d-6.715004995145384!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e6ee28a1327b789%3A0x73a0323bd6d9403e!2sPelindo%202%20Cirebon!5e0!3m2!1sid!2sid!4v1605670503184!5m2!1sid!2sid" width="300" height="250" frameborder="0" style="border:0;" allowfullscreen="false" aria-hidden="false" tabindex="0"></iframe>
              </td>
              <td style="width:2px;"></td>
              <td>
                <td>
                  <div class="lod">
                    <canvas id="myChart" width="384" height="255"></canvas>
                  </div>
                </td>
              </td>
            </tr>
          </table>
          <div id="position">
            <table>
              <tr style="height: 105px; color: white;"><td>Berbahaya</td></tr>
              <tr style="height: 50px; color: white;"><td>Sangat Tidak <br>Sehat</td></tr>
              <tr style="height: 50px; color: black;"><td>Tidak Sehat</td></tr>
              <tr style="height: 30px; color: black;"><td>Sedang</td></tr>
              <tr style="height: 30px; color: black;"><td>Baik</td></tr>
            </table>
          </div>     
          <div id="ispu">
            <table>
              <tr>
                <td style="width: 64px;">ISPU</td>
                <td style="width: 64px;">PM10</td>
                <td style="width: 64px;">SO2</td>
                <td style="width: 64px;">CO</td>
                <td style="width: 64px;">O3</td>
                <td style="width: 64px;">NO2</td>
              </tr>
            </table>
          </div>
        </td>
      </tr>
    </table>

<script>

  function pad(num) {
      num = num.toString();
      if (num.length < 2) num = "0" + num;
      return num;
  }

  function formatTanggal(value) {
      var tanggal = new Date(value.replace(" ","T"));
      var bln = tanggal.getMonth() + 1;
      var tgl = tanggal.getDate();
      var thn = tanggal.getFullYear();
      var time = pad(tanggal.getHours()) + ":" + pad(tanggal.getMinutes());
      return pad(tgl) + "/" + pad(bln) + "/" + pad(thn) + " " + time;
  }


  function startTime() {

    var ajx =  $.ajax({
      url: "https://ispumaps.id/ispumapapi/api/aqmoutdoor?trusur_api_key=VHJ1c3VyVW5nZ3VsVGVrbnVzYV9wVA==&id_stasiun=jakarta",
      type: "GET",
      dataType: "JSON",
      data:JSON.stringify({ }),
      success:function(data){
        console.log(data.waktu);
        $('.waktu').html(formatTanggal(data.waktu))

        var canvas = document.getElementById('myChart');
        height: 660,
        window.chartColors = {
          red: 'rgb(255, 99, 132)',
          orange: 'rgb(255, 159, 64)',
          yellow: 'rgb(255, 205, 86)',
          green: 'rgb(51, 204, 51)',
          blue: 'rgb(54, 162, 235)',
          purple: 'rgb(153, 102, 255)',
          grey: 'rgb(201, 203, 207)'
        };

        var myLineChart = new Chart(canvas,
          {
            type: 'bar',
            data: {
              labels: ["ISPU","PM10", "SO2", "CO", "O3", "NO2"],
              datasets: [{
                // label: '# of Votes',
                data: [0, data.pm10, data.so2, data.co, data.o3, data.pm25],
                backgroundColor: [
                'rgb(255, 174, 71)',
                'rgb(255, 174, 71)',
                'rgb(255, 174, 71)',
                'rgb(255, 174, 71)',
                'rgb(255, 174, 71)',
                'rgb(255, 174, 71)'
                ],
                borderColor: [
                'rgb(0, 0, 255)',
                'rgb(0, 0, 255)',
                'rgb(0, 0, 255)',
                'rgb(0, 0, 255)',
                'rgb(0, 0, 255)',
                'rgb(0, 0, 255)'
                ],
                borderWidth: 1
              }]
            },
            options: {
              legend: {
                  display: false
              },
              responsive: true,
              backgroundRules: [{
                  backgroundColor: '#00f214', 
                  yAxisSegement: 50
              }, {
                  backgroundColor: '#00baf2',
                  yAxisSegement: 100
              }, {
                  backgroundColor: '#eef200',
                  yAxisSegement: 200
              }, {
                  backgroundColor: '#f20000',
                  yAxisSegement: 300
              }, {
                  backgroundColor: '#000',
                  yAxisSegement: 500
              }],
              scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        stepSize: 50,
                        suggestedMax: 500,
                    },
                    gridLines: {
                        display: false,
                    },
                }],
                xAxes: [{
                    ticks: {
                      display: false
                    },
                    gridLines: {
                        display: false,
                    },
                }]
              }
            },
            plugins: [{
              beforeDraw: function (chart) {
                  var ctx = chart.chart.ctx;
                  var ruleIndex = 0;
                  var rules = chart.chart.options.backgroundRules;
                  var yaxis = chart.chart.scales["y-axis-0"];
                  var xaxis = chart.chart.scales["x-axis-0"];
                  var partPercentage = 1 / (yaxis.ticksAsNumbers.length - 1);
                  for (var i = yaxis.ticksAsNumbers.length - 1; i > 0; i--) {
                      if (yaxis.ticksAsNumbers[i] < rules[ruleIndex].yAxisSegement) {
                          ctx.fillStyle = rules[ruleIndex].backgroundColor;
                          ctx.fillRect(xaxis.left, yaxis.top + ((i - 1) * (yaxis.height * partPercentage)), xaxis.width, yaxis.height * partPercentage);
                      } else {
                          ruleIndex++;
                          i++;
                      }
                  }
              }
            }]
          });

      }
    });

    // var t = setTimeout(startTime, 60000);
  }
      // }
    </script>
  </body>
</html>